#!/bin/sh
#
# Wrapper script to run wdbgtest from outside the source tree
# (derived from tools/winewrapper)
#
# Copyright (C) 2002 Alexandre Julliard
#           (C) 2007 Eric Pouech
#
# This library is free software; you can redistribute it and/or
# modify it under the terms of the GNU Lesser General Public
# License as published by the Free Software Foundation; either
# version 2.1 of the License, or (at your option) any later version.
#
# This library is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# Lesser General Public License for more details.
#
# You should have received a copy of the GNU Lesser General Public
# License along with this library; if not, write to the Free Software
# Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301, USA
#

# now find the top-level directory of the source tree

topdir=@WINE_DST_DIR@

# setup the environment

topdir=`cd "$topdir" && pwd`

if [ "`uname -s`" = "Darwin" ]
then
  if [ -n "$DYLD_LIBRARY_PATH" ]
  then
    DYLD_LIBRARY_PATH="$topdir/libs/wine:$DYLD_LIBRARY_PATH"
  else
    DYLD_LIBRARY_PATH="$topdir/libs/wine"
  fi
  export DYLD_LIBRARY_PATH
else
  if [ -n "$LD_LIBRARY_PATH" ]
  then
    LD_LIBRARY_PATH="$topdir/libs/wine:$LD_LIBRARY_PATH"
  else
    LD_LIBRARY_PATH="$topdir/libs/wine"
  fi
  export LD_LIBRARY_PATH
fi

WINELOADER="$topdir/loader/wine"
export WINELOADER

# any local settings ?
if [ -f "$topdir/.winewrapper" ]
then
    . $topdir/.winewrapper
fi

if [ x"$WDBG_DEBUGGER" == x ]
then
    WDBG_DEBUGGER=$topdir/programs/winedbg/winedbg.exe.so
fi

# and run the application

[ -f "./wdbgtest.exe.so" ] && exec "$WINELOADER" "./wdbgtest.exe.so" --debugger $WDBG_DEBUGGER "$@"
echo "$0: cannot find corresponding application"
exit 1
